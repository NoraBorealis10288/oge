@page "/timeranges"
@rendermode InteractiveServer

<PageTitle>Info Page</PageTitle>

<p class="title"><b>Access TimeRanges</b></p>
<hr>

<div class="content">
    @if (Shared.uploadStatus.Equals("file")) {
        Init();

        <h4>Top 10 Doors Accessed Outside Typical Working Hours</h4>

        <table>
            <thead>
                <th>Door</th>
                <th>Accesses</th>
            </thead>
            <tbody>
                @for (int i=0;i<10;i++) {
                    <tr>
                        <td>@Shared.dict[data[i].Item1][0].GetDesc().Substring(22)</td>
                        <td>@data[i].Item2</td>
                    </tr>
                }
            </tbody>
        </table>
    }
</div>

<style>

hr {
    border-top: 5px solid #000;
    opacity: 1;
    width: 80%;
    margin: auto;
}

.title {
    font-size: 70px;
    font-family: 'Courier New', monospace;
}

.content {
    text-align: center;
}

table, th, td {
  border: 1px solid black;
}

table {
    width: 50%;
    margin: auto;
}

th {
    background-color: #6b6c70;
    color: #ffffff;
}

</style>

@code {
    TimeOnly startTime = new TimeOnly(9,0); // set default time to 9:00 AM local time.
    TimeOnly endTime = new TimeOnly(17,0); // set default time to 5:00 PM local time.
    List<(int doorID, int numAccesses)> data = new();

    public void Init() {
        foreach (KeyValuePair<int, List<ReaderEvent>> kvp in Shared.dict) {
            data.Add( (kvp.Key, NumNotInRange(kvp.Value)) );
        }
        data.Sort( (x,y) => y.Item2.CompareTo(x.Item2) );
    }

    public int NumNotInRange(List<ReaderEvent> list) {
        int num = 0;
        foreach (ReaderEvent reader in list) {
            // if after 5pm and before 9am num++;
            TimeOnly eventTime = TimeOnly.FromDateTime(DateTime.Parse(reader.GetTimestamp()));
            if (eventTime.CompareTo(startTime) > 0 && eventTime.CompareTo(endTime) < 0 ) {
                num++;
            }
        }
        return num;    
    }
}